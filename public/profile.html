<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5">
  <title>My Profile</title>
  <link rel="stylesheet" href="/css/style.css">
  <style>
    body {
      background: white;
      min-height: 100vh;
      padding: 20px 0;
    }
    
    .profile-container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .profile-box {
      background: #f5f5f5;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      overflow: hidden;
      border: 4px solid #FFD700;
    }
    
    .profile-header {
      background: #FFD700;
      padding: 30px;
      display: flex;
      align-items: center;
      gap: 30px;
      border-bottom: 4px solid #347433;
    }
    
    .profile-letter-circle {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #347433, #4a8c4a);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      font-weight: bold;
      color: #FFD700;
      border: 5px solid #1B5E20;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
      flex-shrink: 0;
    }
    
    .profile-name-section {
      flex: 1;
    }
    
    .profile-name-section h2 {
      margin: 0 0 8px 0;
      color: #1B5E20;
      font-size: 32px;
      font-weight: bold;
    }
    
    .profile-username {
      color: #347433;
      font-size: 16px;
      font-weight: 600;
    }
    
    .profile-main-content {
      display: flex;
      gap: 30px;
      padding: 30px;
    }
    
    .profile-left-section {
      flex: 1;
      min-width: 300px;
    }
    
    .profile-right-section {
      flex: 2;
    }
    
    .profile-details {
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      padding: 20px;
      backdrop-filter: blur(10px);
    }
    
    .detail-row {
      display: flex;
      padding: 12px 0;
      border-bottom: 2px solid rgba(255, 215, 0, 0.3);
    }
    
    .detail-row:last-child {
      border-bottom: none;
    }
    
    .detail-label {
      font-weight: 700;
      color: #FFD700;
      width: 100px;
      flex-shrink: 0;
      font-size: 15px;
    }
    
    .detail-value {
      color: white;
      font-weight: 600;
      font-size: 15px;
    }
    
    .detail-value.lrn-value {
      color: #2e7d32;
    }
    
    .profile-section-title {
      background: #FFD700;
      color: #1B5E20;
      padding: 12px 20px;
      font-size: 18px;
      font-weight: 700;
      margin: 0 0 15px 0;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .subjects-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 25px;
    }
    
    .subject-tag {
      background: #FFD700;
      color: #1B5E20;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
      border: 2px solid #1B5E20;
    }
    
    .profile-actions {
      padding: 30px;
      display: flex;
      gap: 20px;
      justify-content: center;
      background: rgba(255, 215, 0, 0.1);
      border-top: 3px solid #FFD700;
    }
    
    .btn-customize {
      background: #347433 !important;
      color: white !important;
      padding: 15px 40px !important;
      border-radius: 30px !important;
      font-weight: 700 !important;
      font-size: 16px !important;
      text-decoration: none !important;
      transition: all 0.3s ease !important;
      box-shadow: 0 4px 15px rgba(52, 116, 51, 0.4) !important;
      border: 3px solid #FFCF50 !important;
      display: inline-block !important;
    }
    
    .btn-customize:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(52, 116, 51, 0.6) !important;
      background: #2e6b2e !important;
    }
    
    .btn-back {
      background: #FFCF50 !important;
      color: #347433 !important;
      padding: 15px 40px !important;
      border-radius: 30px !important;
      font-weight: 700 !important;
      font-size: 16px !important;
      text-decoration: none !important;
      transition: all 0.3s ease !important;
      box-shadow: 0 4px 15px rgba(255, 207, 80, 0.4) !important;
      border: 3px solid #347433 !important;
      display: inline-block !important;
    }
    
    .btn-back:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 8px 25px rgba(255, 207, 80, 0.6) !important;
      background: #e6c04a !important;
    }
    
    @media (max-width: 768px) {
      .profile-main-content {
        flex-direction: column;
      }
      
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      
      .profile-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="profile-container">
    <div class="profile-box">
      <div class="profile-header">
        <div class="profile-letter-circle" id="profile-letter">A</div>
        <div class="profile-name-section">
          <h2 id="user-fullname">Loading...</h2>
          <span class="profile-username" id="user-username">@username</span>
        </div>
      </div>
      
      <div class="profile-main-content">
        <div class="profile-left-section">
          <div class="profile-details">
            <div class="detail-row">
              <span class="detail-label">LRN:</span>
              <span class="detail-value lrn-value" id="user-lrn">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Grade:</span>
              <span class="detail-value" id="user-grade">-</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">Section:</span>
              <span class="detail-value" id="user-section">-</span>
            </div>
          </div>
        </div>
        
        <div class="profile-right-section">
          <div class="profile-section-title">STRENGTHS</div>
          <div class="subjects-list" id="strengths-list">
            <span class="subject-tag">Not set</span>
          </div>
          
          <div class="profile-section-title">WEAKNESSES</div>
          <div class="subjects-list" id="weaknesses-list">
            <span class="subject-tag">Not set</span>
          </div>
        </div>
      </div>
      
      <div class="profile-actions">
        <a href="/edit-profile.html" class="btn-customize">Customize</a>
        <a href="/homepage.html" class="btn-back">Back to Dashboard</a>
      </div>
    </div>
  </div>

  <script>
    const backendURL = window.location.origin;

    window.onload = async function() {
      try {
        const response = await fetch(`${backendURL}/get-profile`);
        if (!response.ok) {
          throw new Error('Failed to fetch profile');
        }
        const data = await response.json();

        if (data.success) {
          const user = data.user;
          
          // Set full name
          const fullName = [user.name || '', user.surname || ''].filter(n => n).join(' ') || 'User';
          document.getElementById('user-fullname').innerText = fullName;
          
          // Set username
          document.getElementById('user-username').innerText = '@' + (user.username || 'user');
          
          // Set profile letter
          const letter = (user.name || user.username || 'U').charAt(0).toUpperCase();
          document.getElementById('profile-letter').innerText = letter;
          
          // Set details
          document.getElementById('user-lrn').innerText = user.lrn || '-';
          document.getElementById('user-grade').innerText = user.grade ? 'Grade ' + user.grade : '-';
          document.getElementById('user-section').innerText = user.section || '-';
          
          // Set strengths
          const strengthsList = document.getElementById('strengths-list');
          strengthsList.innerHTML = '';
          (user.strengths || []).forEach(item => {
            if (item) {
              const span = document.createElement('span');
              span.className = 'subject-tag';
              span.textContent = item;
              strengthsList.appendChild(span);
            }
          });
          if (strengthsList.children.length === 0) {
            strengthsList.innerHTML = '<span class="subject-tag" style="background: rgba(255, 255, 255, 0.3); color: #FFD700; border-color: #FFD700;">Not set</span>';
          }
          
          // Set weaknesses
          const weaknessesList = document.getElementById('weaknesses-list');
          weaknessesList.innerHTML = '';
          (user.weaknesses || []).forEach(item => {
            if (item) {
              const span = document.createElement('span');
              span.className = 'subject-tag';
              span.textContent = item;
              weaknessesList.appendChild(span);
            }
          });
          if (weaknessesList.children.length === 0) {
            weaknessesList.innerHTML = '<span class="subject-tag" style="background: rgba(255, 255, 255, 0.3); color: #FFD700; border-color: #FFD700;">Not set</span>';
          }
        } else {
          window.location.href = '/index.html';
        }
      } catch (error) {
        console.error("Error fetching profile:", error);
        window.location.href = '/index.html';
      }
    };
  </script>
</body>
</html>
